<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>シンプル・プル・ゴルフ</title>
    <style>
        body { text-align: center; background-color: #2c3e50; color: white; font-family: sans-serif; }
        canvas { background-color: #2ecc71; border: 5px solid #27ae60; cursor: crosshair; touch-action: none; }
        .ui { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>プル・ゴルフ</h1>
    <canvas id="gameCanvas" width="800" height="500"></canvas>
    <div class="ui">
        <p>ボールを引っ張って、穴（黒い円）に入れよう！</p>
        <button onclick="resetGame()">リセット</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let ball = { x: 100, y: 400, radius: 15, vx: 0, vy: 0, isDragging: false };
        let hole = { x: 700, y: 100, radius: 25 };
        let mouse = { x: 0, y: 0 };
        const friction = 0.98; // 摩擦

        // マウスイベント
        canvas.addEventListener('mousedown', startDrag);
        canvas.addEventListener('mousemove', drag);
        canvas.addEventListener('mouseup', endDrag);

        function startDrag(e) {
            const rect = canvas.getBoundingClientRect();
            const mx = e.clientX - rect.left;
            const my = e.clientY - rect.top;

            // ボールの近くをクリックしたか判定
            const dist = Math.hypot(mx - ball.x, my - ball.y);
            if (dist < 30 && ball.vx === 0 && ball.vy === 0) {
                ball.isDragging = true;
            }
        }

        function drag(e) {
            const rect = canvas.getBoundingClientRect();
            mouse.x = e.clientX - rect.left;
            mouse.y = e.clientY - rect.top;
        }

        function endDrag() {
            if (ball.isDragging) {
                // 引っ張った方向の逆に飛ばす（アングリーバード方式）
                ball.vx = (ball.x - mouse.x) * 0.15;
                ball.vy = (ball.y - mouse.y) * 0.15;
                ball.isDragging = false;
            }
        }

        function update() {
            if (!ball.isDragging) {
                ball.x += ball.vx;
                ball.y += ball.vy;

                // 摩擦
                ball.vx *= friction;
                ball.vy *= friction;

                // 停止判定
                if (Math.abs(ball.vx) < 0.1) ball.vx = 0;
                if (Math.abs(ball.vy) < 0.1) ball.vy = 0;

                // 壁の反射
                if (ball.x + ball.radius > canvas.width || ball.x - ball.radius < 0) ball.vx *= -0.7;
                if (ball.y + ball.radius > canvas.height || ball.y - ball.radius < 0) ball.vy *= -0.7;
            }

            // クリア判定
            const distToHole = Math.hypot(ball.x - hole.x, ball.y - hole.y);
            if (distToHole < hole.radius && Math.abs(ball.vx) < 2) {
                alert("ホールインワン！おめでとう！");
                resetGame();
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 穴
            ctx.beginPath();
            ctx.arc(hole.x, hole.y, hole.radius, 0, Math.PI * 2);
            ctx.fillStyle = "black";
            ctx.fill();
            ctx.closePath();

            // 旗（簡易）
            ctx.fillStyle = "red";
            ctx.fillRect(hole.x, hole.y - 60, 30, 20);
            ctx.strokeStyle = "white";
            ctx.strokeRect(hole.x, hole.y - 60, 1, 60);

            // 引っ張る線のガイド
            if (ball.isDragging) {
                ctx.beginPath();
                ctx.moveTo(ball.x, ball.y);
                ctx.lineTo(mouse.x, mouse.y);
                ctx.strokeStyle = "rgba(255, 255, 255, 0.5)";
                ctx.setLineDash([5, 5]);
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // ボール
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fillStyle = "white";
            ctx.fill();
            ctx.strokeStyle = "#999";
            ctx.stroke();
            ctx.closePath();

            update();
            requestAnimationFrame(draw);
        }

        function resetGame() {
            ball.x = 100;
            ball.y = 400;
            ball.vx = 0;
            ball.vy = 0;
        }

        draw();
    </script>
</body>
</html>
